# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Основные классы 

### Api

Базовый класс для отправки и получения запросов к серверу. В конструктор передаётся базовый адрес сервера и, опционально, объект с заголовками запросов.

**Параметры конструктора:**

```baseUrl``` - базовый адрес сервера.

```options``` - объект с заголовками запросов.


**Методы:**

```handleResponse``` - принимает ответ от сервера как параметр, и обрабатывает его,возвращая результат в формате json или отклоненный промис с возникшей ошибкой. get- выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер. post- принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется 'POST' запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

### EventEmitter

Классическая реализация брокера событий. Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

**Свойства:**
- `events` — структура для хранения событий.

**Основные методы:**
- `on` — подписка на событие.
- `off` — отписка от события.
- `emit` — инициирует событие.
- `onAll` — подписка на все события.
- `offAll` — сбрасывает все обработчики событий.
- `trigger` — возвращает функцию, при вызове которой инициируется событие.

### Component

Абстрактный базовый класс, предназначенным для создания компонентов пользовательского интерфейса. Класс обеспечивает инструментарий для управления DOM элементами и поведением компонента. Наследуется всеми классами представления(View).

**Методы:**
- `toggleClass` - переключается класс для переданного элемента.
- `setText` - устанавливает текстовое содержимое для переданного элемента.
- `setImage` - устанавливает изображения и альтернативный текст для изоображения(опционально) для переданного элемента типа HTMLImageElement.
- `setDisabled` - изменяет статус блокировки для переданного элемента.
- `setHidden , setVisible` - скрывает, отображает переданный элемент.
- `render` - рендерит компонент, используя переданные данные. Метод должен быть переназначен в дочерних классах.

### PopupComponent

Реализует модальное окно.

**Cкрытые свойства:**

- `_closeBtn` - элемент кнопки закрытия модального окна.
- `_content` - элемент с содержимым модального окна.

**Сеттер:**

- `content` - меняет содержимое модального окна.

**Методы:**

- `open` - открывает модальное окно и эмитит ивент modal:open.
- `close` - закрывает и стирает содержимое модального окна, также эмитит ивент modal:close.
- `render` - рендерит модальное окно с переданным содержимым и открывает его.

### Basket

Реализует корзину. Предоставляет сеттеры для изменения отображения корзины.

**Скрытые свойства:**

- `_list` - элемент содержимого корзины (карточек товаров).
- `_total` - элемент суммы товаров в корзине.
- `_button` - элемент кнопки оформления заказа в корзине.

**Сеттеры:**

- `items` - меняет содержимое в корзине в зависимости от переданных товаров.
- `total` - меняет значение в элементе суммы товаров на переданное.
- `selected` - переключает активность кнопки.

**Геттер:**

- `items` - меняет текст кнопки в зависимости от количества товаров.

### Card

Реализует карточку товара (используется на главной, в модальном окне и в корзине).

**Cкрытые свойства:**

- `_title` - элемент заголовка карточки.
- `_image` - элемент картинки карточки.
- `_price` - элемент цены карточки.
- `_category` - элемент категории карточки.
- `_description` - элемент описания карточки.
- `_button` - элемент кнопки карточки.

**Сеттеры:**

- `id` - принимает и задает id карточки.
- `title` - меняет содержимое заголовка на полученное.
- `price` - меняет содержимое контейнера с ценой на полученное.
- `category` - меняет содержимое контейнера с категорией на полученное.
- `image` - меняет изображение и альтернативный текст в карточке.
- `description` - меняет содержимое контейнера с описанием на полученное.

**Геттеры:**

- `id` - возвращает данные id карточки.
- `title` - возвращает содержимое заголовка на полученное.

**Метод:**

- `nextStep` - изменяет текст кнопки.

### Contact

Реализует компонент формы контактов. Наследуется от класса Form.

**Cкрытые свойства:**

- `_email` - инпут с имэйлом.
- `_phone` - инпут с телефоном.

**Сеттеры:**

- `email`- меняет содержимое поля email в форме.
- `phone` - меняет содержимое поля phone в форме.
- `valid` - блокирует кнопку, если какое то из полей не заполнено.

### Page

Реализует главную страницу - каталог товаров с счетчиком.

**Скрытые свойства:**

- `_counter` - элемент счетчика на странице. -_catalog - элемент каталога на странице.
- `_wrapper` - элемент обертки на странице.
- `_basket` - элемент корзины на странице.

**Сеттеры:**

- `counter` - меняет содержимое счетчика на полученное.
- `catalog` - меняет содержмое каталога на полученные элементы.
- `locked` - меняет класс обертки на значение, соответствующее переданному.

### Success

Реализует окно с подтверждением заказа.

**Поля:**

- `_close` - элемент кнопки закрытия окна.
- `_total` - элемент с суммой заказа.

**Сеттеры:**

- `total` - меняет содержимое элемента с суммой заказа.

### ProductApi

Позволяет взаимодействовать с API продуктов.

**Поля:**

- `_cdn`

**Методы:**

- `getProductList` - получает список всех продуктов.
- `getProductItem*` - получает подробную информацию о продукте по его идентификатору.
- `OrderProduct` — размещает заказ на продукт.

### State

Управляет состоянием приложения, связанным с каталогом товаров и оформлением заказа.

**Поля:**

- `catalogue` - массив товаров.
- `order` - Объект заказа.
- `FormOfderErrors` - Объект с ошибками формы заказа.
- `FormOfderContacts` - Объект с ошибками контактной формы.

**Методы:**

- `validateContacts` - Проверяет заполненность контактных данных и записывает ошибки в formContactsErrors.
- `validateOrder` - Проверяет заполненность полей заказа и записывает ошибки в formOrderErrors.
- `toogleOrderItem` - Добавляет или удаляет товар из заказа.
- `clearBasket` - Очищает корзину и обнуляет данные заказа.
- `total` - Считает сумму всех товаров в заказе.
- `isFilledFielsOrder` - Проверяет, заполнены ли поля заказа.
- `isFilledFielsContact` - Проверяет, заполнены ли контактные данные.
- `clearOrderFealds` - Очищает данные заказа.
- `setCatalogue` - Устанавливает каталог товаров и отправляет событие items:change.
- `getCards` - Возвращает массив товаров, добавленных в корзину.
- `setFields` - Устанавливает значение в объекте заказа и запускает валидацию.

### BasketItem

**Поля:**

- `index` - элемент, отражающий порядковый номер.
- `btn` - кнопка удаления товаров из корзины.

**Сеттеры:**

- `index` - меняет число количества товаров в корзине.

### Form

Предназначен для работы с формами и взаимодействия с состоянием приложения (IState).

**Скрытые свойства:**

- `_error`s - контейнер с сообщениями об ошибках.
- `events` - Объект для управления событиями.
- `container` - Контейнер, в котором находится форма.

**Сеттеры:**

- `errors` - меняет содержмое компонента с ошибками формы на переданное.

**Методы:**

- `onInputChange` - эмитит событие order:change с переданными параметрами.
- `render` - рендерит компонент формы, используя переданное состояние.
- `onPaymentChange` - Отправляет событие order:change, указывая, что изменилось поле payment.

### Order

Реализует компонент формы отправки заказа.

**Скрытые свойства:**

- `_submit` - кнопка оформления заказа.
- `_btn` - кнопка выбора оплатой наличными.
- `_btnCard` - кнопка выбора оплатой картой.

**Сеттеры:**

- `valid` - Включает/отключает кнопку "Оформить заказ".
- `address` - меняет содержимое поля address в форме.

**Методы:**

- `onPaymentChange` - меняет способ оплаты.

## События приложения

- `items:changed` - изменение массива товаров каталога.
- `basket:changed` - изменение списка товаров корзины.
- `formOrderErrors:change` - изменение в списке ошибок валидации формы.
- `formContactErrors:change` - изменение в списке ошибок валидации формы.
- `modal:open` - открытие любого модального окна.
- `modal:close` - закрытие любого модального окна.
- `basket:open` - открытие модального окна корзины.
- `card:select` - выбор карточки.
- `order:open` - открытие окна оформления заказа.
- `order:submit` - отправка формы.
- `order:change` - изменение поля в форме.

## Основные интерфейсы

###IPage### Управление элементами на странице.

**Свойства:**

- `counter: number` — счетчик элементов.
- `catalogue: HTMLElement[]` — массив элементов каталога.
- `locked: boolean` — флаг, указывающий, заблокирована ли страница.

###IProducts### Каталог продуктов.

**Свойства:**

- `items: IProd[]` — массив элементов галереи.
###ISuccess### Результат успешной операции.

**Свойства:**

- `total: number` — общее значение.
###IProduct### Данные продукта.

**Свойства:**

- `description?: string` — описание продукта. (необязательно)
- `id: string` — идентификатор продукта.
- `image: string` — URL изображения продукта.
- `title: string` — заголовок продукта.
- `category: string` — категория продукта.
- `price: number | null` — цена продукта.
###IOrder### Данные заказа. Наследуется от `IContact.`

**Свойства:**

- `total: number` — общая стоимость заказа.
- `items: string[]` — массив идентификаторов продуктов в заказе.
- `payment: string` — информация о способе оплаты.
- `address: string` — информация об адресе доставки.
###IOrderForm### Валидация формы заказа. Наследуется от `ContactsError` и `OrderError.`

###IOrderResult### Ответ от сервера при заказе.

**Свойства:**

- `id: string` — идентификатор заказа.
- `total: number` — общая стоимость заказа.
###IContact### Контактная информация.

**Свойства:**

- `email: string` — адрес электронной почты.
- `phone: string` — номер телефона.
###IBasket### Данные корзины.

**Свойства:**

- `items: HTMLElement[]` — массив продуктов в корзине.
- `total: number` — общая стоимость товаров в корзине.
- `selected: string[]` — массив идентификаторов выбранных товаров в корзине.
###IAction### Функция нажатия на кнопку.

**Свойства:**

- `onClick () => void` — функция, которая вызывается при успешном выполнении действия.
###IActionEvent### Функция нажатия на кнопку и получение объекта события.

**Свойства:**

- `onClick (evt: MouseEvent) => void` — функция, которая вызывается при нажатии на элемент.
###OrderError### Валидация полей формы заказа.

**Свойства:**

- `address?: string` — ошибка в поле адреса. (необязательно)
- `payment?: string` — ошибка в поле способа оплаты. (необязательно)
###ContactsError### Валидация полей формы контактов.

**Свойства:**

- `email?: string` — ошибка в поле адреса электронной почты. (необязательно)
- `phone?: string` — ошибка в поле номера телефона. (необязательно)
###IOrdersForm### Форма заказа. Наследуется от IState.

**Свойства:**

- `items: string[]` — массив идентификаторов товаров в заказе.
- `total: number` — общая стоимость заказа.
- `address`
- `payment:` string;
- `email:` string;
`phone:` string;

### IState
**Cостояние валидации.**

**Свойства:**

- `validation: boolean` — статус проверки.
- `errors: string[]` — массив сообщений об ошибках.
